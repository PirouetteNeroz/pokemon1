const { createApp, ref, computed } = Vue;
const vuetify = Vuetify.createVuetify({
    theme: {
        defaultTheme: 'dark',
        themes: {
            dark: {
                colors: {
                    primary: '#FFD700',
                    secondary: '#1E1E1E',
                    background: '#121212',
                    surface: '#1E1E1E',
                    error: '#FF5252',
                    info: '#2196F3',
                    success: '#4CAF50',
                    warning: '#FFC107',
                },
            },
            light: {
                colors: {
                    primary: '#1976D2',
                    secondary: '#424242',
                    background: '#FFFFFF',
                    surface: '#FFFFFF',
                    error: '#FF5252',
                    info: '#2196F3',
                    success: '#4CAF50',
                    warning: '#FFC107',
                },
            },
        },
    },
});

const app = createApp({
    setup() {
        const series = ref([]);
        const searchQuery = ref('');
        const isDarkTheme = ref(true);
        const isLoading = ref(true);

        // Charger toutes les séries
        async function fetchAllSeries() {
            try {
                const response = await fetch('https://api.tcgdex.net/v2/fr/sets');
                if (!response.ok) throw new Error('Impossible de récupérer les séries');
                series.value = await response.json();
            } catch (error) {
                console.error('Erreur:', error.message);
            } finally {
                isLoading.value = false; // Fin du chargement
            }
        }

        // Grouper les séries par blocs
        const groupedSeries = computed(() => {
            if (!series.value || series.value.length === 0) return []; // Retourne un tableau vide si series.value est vide
            const blocks = [
                { name: 'Scarlet & Violet', series: [] },
                { name: 'Sword & Shield', series: [] },
                { name: 'Sun & Moon', series: [] },
                { name: 'XY', series: [] },
                { name: 'Black & White', series: [] },
            ];

            series.value.forEach(serie => {
                if (!serie.name || !serie.logo) return; // Ignorer les séries sans nom ou logo
                if (serie.name.includes('Scarlet & Violet')) {
                    blocks[0].series.push(serie);
                } else if (serie.name.includes('Sword & Shield')) {
                    blocks[1].series.push(serie);
                } else if (serie.name.includes('Sun & Moon')) {
                    blocks[2].series.push(serie);
                } else if (serie.name.includes('XY')) {
                    blocks[3].series.push(serie);
                } else if (serie.name.includes('Black & White')) {
                    blocks[4].series.push(serie);
                }
            });

            return blocks.filter(block => block.series.length > 0);
        });

        // Rediriger vers l'inventaire avec le filtre de l'extension
        function goToInventory(serie) {
            const cardtraderName = serie.name; // Utilisez le mapping ou la correspondance approximative ici
            window.location.href = `/inventory.html?extension=${encodeURIComponent(cardtraderName)}`;
        }

        // Basculer entre le thème sombre et clair
        function toggleTheme() {
            isDarkTheme.value = !isDarkTheme.value;
            vuetify.theme.global.name.value = isDarkTheme.value ? 'dark' : 'light';
        }

        // Charger les séries au démarrage
        fetchAllSeries();

        return {
            series,
            searchQuery,
            groupedSeries,
            goToInventory,
            toggleTheme,
            isLoading,
        };
    },
});

app.use(vuetify);
app.mount('#app');
